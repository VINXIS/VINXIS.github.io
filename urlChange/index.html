<!DOCTYPE html>
<html><head>
    <link rel="stylesheet" href="main.css">
    <script>
// /html/head/title/text()
function urlChanger(value) {
  var verify = /(http(s)?:\/\/)?(www)?osu.ppy.sh\/(s|beatmapsets)\/.+/i;
  var verification = verify.test(value);
  console.log(verification);
  if (verification === true) {
    var linkType = verify.exec(value);
    console.log(linkType);
    if (linkType[4] === 's') {
      var fixValue = value.replace(/osu.ppy.sh\/s\//i,'osu.ppy.sh/beatmapsets/');
      var newValue = fixValue.trim();
      console.log(newValue);

    }
    else {
      var check = value.indexOf('#');
      console.log(check);
      if (check !== -1) {
        fixValue = value.slice(0,check);
      }
      else {
        fixValue = value;
      }

      newValue = fixValue.trim();
      console.log(newValue);
    }

    var xmlHttp = new XMLHttpRequest();
    xmlHttp.addEventListener("load", reqListener);
    xmlHttp.open("GET", newValue);
    xmlHttp.withCredentials = true;
    
    xmlHttp.send();

    function reqListener() {
      console.log(this.responseText);
      parser = new DOMParser();
      var parse = parser.parseFromString(this.responseText,"text/xml");
      console.log(parse);
      var trim = parse.getElementsByTagName("title")[0].childNodes[0].nodeValue.trim();
      console.log(trim);
      var title_and_artist = trim.slice(0,trim.length()-trim.indexOf('Â·'));
      console.log(title_and_artist);


      var result = '[url=' + newValue + ']'+ title_and_artist + '[/url]';
      console.log(result);

      //var swapRegex = /(.+) - (.+)/i;


      return result;
    };
  }
  else {
    return 'Input is invalid! Must be an /s/ or /beatmapsets/ link (Preferably /s/)';
  }
}
function button() {
    document.getElementById("result").value = urlChanger(document.getElementById("entry").value);
}
</script>
  <title>osu!beatmap URL BB Code Generator</title>
  <meta name="description" content="BB Code Generator for osu! map links.">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:domain" content="vinxis.moe/urlChang/">
  <meta property="og:type" content="website">
  <meta property="og:image" itemprop="image primaryImageOfPage" content="8wPQd831.png">
  <meta name="twitter:title" property="og:title" itemprop="title name" content="VINXIS">
  <meta name="twitter:description" property="og:description" itemprop="description" content="BB Code Generator for osu! map links." >
  <meta property="og:url" content="http://vinxis.moe/urlChange/">
  <meta property="og:url" content="http://www.vinxis.moe/urlChang/">
  <link rel="shortcut icon" href="favicon.ico?">
  <link rel="stylesheet" href="main.css">
  <meta name="robots" content="index, follow, noodp">
</head>
<body>
<div>
<div id="box1">
  <h1 id="entryheader">Original text</h1>
  <textarea id="entry" placeholder="Insert text here!"></textarea>
</div>
<button type="button" onclick="button()">Get the BB Code Bro</button>
  <div id="box2">
  <h1 id="resultheader">Translated text</h1>
  <textarea  id="result" placeholder="Text result!"></textarea>
  </div>
 </body></html>
